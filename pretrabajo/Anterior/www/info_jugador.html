<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Cantabria Padel Rank v3</title>
        <link rel="shortcut icon" href="favicon.ico">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
    	<link rel="stylesheet" href="css/general.css">
		<link rel="stylesheet" href="css/ficha_jugador.css">
    	
        <link rel="stylesheet" href="css/JK7.min.css">
        <link rel="stylesheet" href="css/jquery.mobile.icons.min.css">
        <link rel="stylesheet" href="css/jquery.mobile.structure-1.4.5.min.css">
                    
        <script src="js/jquery-1.11.2.min.js"></script>
        <script src="js/jquery.mobile-1.4.5.min.js"></script>
        <script src="js/generales.js"></script>
        
        <script charset="utf-8">
        
            $( document ).on( "pagecreate", function() {
    
                // Obtenemos el ID del jugador que vamos a buscar su informacion
                var id 		= $_GET("id");
    //alert(id);
                var fecha	= new Date();
                var anno 	= fecha.getFullYear();
				var lig_w	= 0; // Partidos de liga ganados
				var lig_l 	= 0; // Partidos de liga perdidos
				var cop_w 	= 0; // Partidos de copa ganados
				var cop_l 	= 0; // Partidos de copa perdidos
				var cir_w 	= 0; // Partidos de circuito ganados
				var cir_l 	= 0; // Partidos de circuito perdidos
				var mas_w 	= 0; // Partidos de circuito ganados
				var mas_l 	= 0; // Partidos de circuito perdidos
				var lose	= 0; // Derrota
				var ratio 	= 0; // Media
                
				var lig2_w	= 0; // Partidos de liga ganados
				var lig2_l 	= 0; // Partidos de liga perdidos
				var cop2_w 	= 0; // Partidos de copa ganados
				var cop2_l 	= 0; // Partidos de copa perdidos
				var cir2_w 	= 0; // Partidos de circuito ganados
				var cir2_l 	= 0; // Partidos de circuito perdidos
				var mas2_w 	= 0; // Partidos de circuito ganados
				var mas2_l 	= 0; // Partidos de circuito perdidos

				var ratio2 	= 0; // Media
				
				
                $.ajax({
                    url: PATH + "ws_resp_info_jugador.php",
                    type: 'GET',
                    dataType: 'json',
                    async: false,
                    crossDomain: true,
                    timeout: 5000,
                    data: {
                        id	: id, 
                        temp: anno
                    },
                    success: function(data){
                        
                        $("#lbName").html(data[0].jugador);
                        $("#lbEquipo").html("<a href='info_equipo.html?id=" + data[0].id_equipo + "'  data-ajax='false'>" + data[0].equipo + "</a>");
                        $("#lbCategoria").html(data[0].categoria);
                        $("#lbCircuito").html(data[0].categoria2);
                        $("#lbPuntos").html(data[0].puntos);
                        
                        var row_html = "";
                        var img_html = "<img id='imgPhoto' class='image_block' title='" + data[0].jugador + "' " + 
                                            "src='http://topera.esy.es/img/players/x_" + id + ".jpg' " + 
                                            "alt='" + data[0].jugador + "' OnError='this.src=\"img/sin_foto_75x70.png\"' >";
    
    
                        
                        $("#player_data_photo").html(img_html);
    ///////////////////////////////					
                        $.ajax({
                            url: PATH + "ws_resp_partidos_jugador.php",
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            crossDomain: true,
                            timeout: 5000,
                            data: {
                                id	: id
                            },
                            success: function(data2){
                                
    //idjugador, fecha, torneo, marcador, pareja, rival1, rival2, puntos							
                                var i 		= 0;							
    
                                html = 	"<table data-role='table' id='info_partidos' data-mode='table' class='ui-responsive'>" +
                                        "	<thead>" +
                                        "		<tr>" +
                                        "			<th></th>" +
                                        "			<th data-priority='1'>Fecha</th>" +
                                        "			<th></th>" +
                                        "			<th data-priority='4'>Pareja</th>" +
                                        "			<th data-priority='3'>Rivales</th>" +
                                        "			<th data-priority='2'>Puntos</th>" +
                                        "		</tr>" +
                                        "	</thead>" +
                                        "	<tbody>";
                                        
                                while (i < data2.length){
    
                                    html = html + "<tr>";								
    
                                    if (eval(data2[i].marcador) > 0){
                                        html = html + "	<td><img src='http://topera.esy.es/img/victory.png' class='img_victory'></td>";
										lose = 0;
                                    }
                                    else{
                                        html = html + "	<td><img src='http://topera.esy.es/img/defeat.png' class='img_defeat'></td>";
										lose = 1;
                                    }
                                    
									
                                    html = html + 	"	<td>" + data2[i].fecha + "</th>";
									var datfec = data2[i].fecha;
                                    datfec = datfec.substring(datfec.length - 4);
									var stats = (datfec == anno - 1);
									var stats2 = (datfec == anno - 2);
																		
                                    var img = "";
                                    if (data2[i].torneo == "MASTER"){
                                        img = "http://topera.esy.es/img/master.png";
										if (stats){
											if (lose == 1){
												mas_l++; 
											}
											else{
												mas_w++;
											}
										}
										if (stats2){
											if (lose == 1){
												mas2_l++; 
											}
											else{
												mas2_w++;
											}
										}
                                    }else if (data2[i].torneo == "REGIONAL"){
                                        img = "http://topera.esy.es/img/regional.png";
										if (stats){
											if (lose == 1){
												cir_l++; 
											}
											else{
												cir_w++;
											}
										}
										if (stats2){
											if (lose == 1){
												cir2_l++; 
											}
											else{
												cir2_w++;
											}
										}
                                    }else if (data2[i].torneo == "CIRCUITO"){
                                        img = "http://topera.esy.es/img/circuito.png";
										if (stats){
											if (lose == 1){
												cir_l++; 
											}
											else{
												cir_w++;
											}
										}
										if (stats2){
											if (lose == 1){
												cir2_l++; 
											}
											else{
												cir2_w++;
											}
										}
                                    }else if (data2[i].torneo == "COPA"){
                                        img = "http://topera.esy.es/img/copa.png";
										if (stats){
											if (lose == 1){
												cop_l++; 
											}
											else{
												cop_w++;
											}
										}
										if (stats2){
											if (lose == 1){
												cop2_l++; 
											}
											else{
												cop2_w++;
											}
										}
                                    }else if (data2[i].torneo == "LIGA"){
                                        img = "http://topera.esy.es/img/liga.png";
										if (stats){
											if (lose == 1){
												lig_l++; 
											}
											else{
												lig_w++;
											}
										}
										if (stats2){
											if (lose == 1){
												lig2_l++; 
											}
											else{
												lig2_w++;
											}
										}
                                    }else if (data2[i].torneo == "TORNEO"){
                                        img = "http://topera.esy.es/img/torneo.png";
                                    }
                                    
                                    html = html + 	"	<td><img src='" + img + "' class='img_torneo'></td>";
                                    
                                    if (data2[i].id_pareja != null){
                                        html = html + "	<td><a href='info_jugador.html?id=" + data2[i].id_pareja +"' data-ajax='false'>" + data2[i].pareja + "</a></td>";
                                    }
                                    else{
                                        html = html + "	<td>" + data2[i].pareja + "</td>";
                                    }
                                    if (data2[i].id_rival1 != null){
                                        html = html + "	<td>-<a href='info_jugador.html?id=" + data2[i].id_rival1 +"' data-ajax='false'>" + data2[i].rival1 + "</a><br>-";
                                    }
                                    else{
                                        html = html + "	<td>-" + data2[i].rival1 + "<br>-";
                                    }
                                    if (data2[i].id_rival2 != null){
                                        html = html + "<a href='info_jugador.html?id=" + data2[i].id_rival2 +"' data-ajax='false'>" + data2[i].rival2 + "</a></td>"
                                    }
                                    else{
                                        html = html + data2[i].rival2 + "</td>";
                                    }
                                    
                                    html = html + " <td>" + data2[i].puntos + "</td>" +
                                                    "</tr>";									
                                    i++;
                                }							
                                html = html + "	</tbody>" +
                                              "</table>";
                            }
                        });
                        $("#table_box_par").html(html);
						$("#p").addClass("ui-btn-active");
                    }
                });
				
				$("#lbAnno").html(anno-1);				
				html = datosTorneo(lig_w, lig_l);
				$("#lbLiga").html(html);				
				html = datosTorneo(cop_w, cop_l);
				$("#lbCopa").html(html);				
				html = datosTorneo(cir_w, cir_l);
				$("#lbCir").html(html);				
				html = datosTorneo(mas_w, mas_l);
				$("#lbMaster").html(html);
				
				$("#lbAnno2").html(anno-2);				
				html = datosTorneo(lig2_w, lig2_l);
				$("#lbLiga2").html(html);				
				html = datosTorneo(cop2_w, cop2_l);
				$("#lbCopa2").html(html);				
				html = datosTorneo(cir2_w, cir2_l);
				$("#lbCir2").html(html);				
				html = datosTorneo(mas2_w, mas2_l);
				$("#lbMaster2").html(html);
				
				
				$("#lbAnnoT").html("Total");				
				html = datosTorneo(lig_w + lig2_w, lig_l + lig2_l);
				$("#lbLigaT").html(html);				
				html = datosTorneo(cop_w + cop2_w, cop_l + cop2_l);
				$("#lbCopaT").html(html);				
				html = datosTorneo(cir_w + cir2_w, cir_l + cir2_l);
				$("#lbCirT").html(html);				
				html = datosTorneo(mas_w + mas2_w, mas_l + mas2_l);
				$("#lbMasterT").html(html);
				
            });
			
			function datosTorneo(win, lose){
				
				divisor = win + lose;
				if (divisor > 0){
					ratio = ((win/divisor)*100).toFixed(2);
				}else{
					ratio = 0;
				}
				txt = "W:" + win + " L:" + lose + " %:" + ratio;				
				return txt;				
			}
        </script>
    
    </head>
	<body>

		<!-- INICIO PAGINA -->
        <div data-role="page" class="ui-responsive-panel" data-add-back-btn="true">
            <!-- INICIO CABECERA -->    
            <div data-role="header" data-theme="a">
                <a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>                
                <h1><a href="https://play.google.com/store/apps/details?id=com.jk7.CantabriaPdlRank2&hl=es" class="titulo">C.P.R.</a></h1>
                <a href="#" data-icon="back" data-iconpos="notext" data-rel="back">Atras</a>                
            </div>
            <!-- FIN CABECERA -->
			<!-- INICIO CONTENIDO -->
            <div data-role="content">
<!----------------------------------------------------------->
                <div class="player_box">
                    <div class="player_data_block_white" style="margin-top: 8px">
                        <span id="lbNameTitle" class="player_data_title">Nombre</span>
                        <span id="lbName" class="player_data_value"></span>	
                    </div>
                    <div style="overflow: hidden">
                        <div class="player_data_photo" id="player_data_photo">                            
                        </div>
                        <div class="player_data_main">
                            <div class="player_data_block">
                                <span id="lbEquipoTittle" class="player_data_title">Equipo</span>
                                <span id="lbEquipo" class="player_data_value"></span>
                            </div>
                            <div class="player_data_block">
                                <span id="lbCategoriaTittle" class="player_data_title">Categoría</span>
                                <span id="lbCategoria" class="player_data_value"></span>
                            </div>
                            <div class="player_data_block">
                                <span id="lbCircuitoTittle" class="player_data_title">Ranking</span>
                                <span id="lbCircuito" class="player_data_value"></span>
                            </div>
                             <div class="player_data_block" style="margin-top: 8px">
                                <span id="lbPuntosTitle" class="player_data_title">Puntos</span>
                                <span id="lbPuntos" class="player_data_value"></span>
            <!--					<a id="hlTeam" class="player_data_link" href="team.aspx?data=qJ9ob7lzluQ=">La Cavada Promesas</a>-->
                            </div>
                            <div class="player_data_block">
                            </div>
                        </div>
                        
                    </div>               
                </div>
                
                
                <div data-role="tabs" id="tabs">
                    <div data-role="navbar">
                        <ul>
                            <li><a href="#tab-1" id="p" data-ajax="false">Partidos</a></li>
                            <li><a href="#tab-2" id="e" data-ajax="false">Estadísticas</a></li>                        
                        </ul>
                    </div>
                    <div id="tab-1" class="ui-body-d ui-content">
						<div class="table_box" id="table_box_par"></div> 
                    </div>
                    <div id="tab-2">
                        <div class="table_box" id="table_box_est">
                        
                            <div class="player_data_main_aux">
                                <div class="player_data_block">
                                    <span id="lbAnnoTittleT" class="player_data_title">Año</span>
                                    <span id="lbAnnoT" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbLigaTittleT" class="player_data_title">Liga:</span>
                                    <span id="lbLigaT" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbCopaTittleT" class="player_data_title">Copa:</span>
                                    <span id="lbCopaT" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbCirTittleT" class="player_data_title">Cir.:</span>
                                    <span id="lbCirT" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbMasterTittleT" class="player_data_title">Mas.:</span>
                                    <span id="lbMasterT" class="player_data_value"></span>
                                </div>
                            </div>
                            
                            <div class="player_data_main_aux">
                                <div class="player_data_block">
                                    <span id="lbAnnoTittle" class="player_data_title">Año</span>
                                    <span id="lbAnno" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbLigaTittle" class="player_data_title">Liga:</span>
                                    <span id="lbLiga" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbCopaTittle" class="player_data_title">Copa:</span>
                                    <span id="lbCopa" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbCirTittle" class="player_data_title">Cir.:</span>
                                    <span id="lbCir" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbMasterTittle" class="player_data_title">Mas.:</span>
                                    <span id="lbMaster" class="player_data_value"></span>
                                </div>
                            </div>
                        
                        	<div class="player_data_main_aux">
                                <div class="player_data_block">
                                    <span id="lbAnnoTittle2" class="player_data_title">Año</span>
                                    <span id="lbAnno2" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbLigaTittle2" class="player_data_title">Liga:</span>
                                    <span id="lbLiga2" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbCopaTittle2" class="player_data_title">Copa:</span>
                                    <span id="lbCopa2" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbCirTittle2" class="player_data_title">Cir.:</span>
                                    <span id="lbCir2" class="player_data_value"></span>
                                </div>
                                <div class="player_data_block">
                                    <span id="lbMasterTittle2" class="player_data_title">Mas.:</span>
                                    <span id="lbMaster2" class="player_data_value"></span>
                                </div>
                            </div>
                        
                        
                        </div>
                    </div>
                </div>   
         
<!------------------------------------------------------------------>            
			</div>
            <!-- FIN CONTENIDO -->
            <!-- INICIO PIE -->
            <div >
                <a href="http://tunein.com/radio/Radio-Meruelo-1071-s114032/">
                	<img src='http://topera.esy.es/img/radio_meruelo.png' class="footer">
                </a>
            </div>
            <!-- FIN PIE -->
                
			<style>
                .nav-search .ui-btn-up-a {
                    background-image:none;
                    background-color:#333333;
                }
                .nav-search .ui-btn-inner {
                    border-top: 1px solid #888;
                    border-color: rgba(255, 255, 255, .1);
                }
            </style>

			<!-- INICIO MENU -->    
            <div data-role="panel" data-position="left" data-position-fixed="false" data-display="reveal" id="nav-panel" data-theme="a">
                <ul data-role="listview" data-theme="a" data-divider-theme="a" style="margin-top:-16px;" class="nav-search">                    
                    <li data-filtertext="wai-aria voiceover accessibility screen reader">
                        <a href="index.html" data-ajax="false">Inicio</a>
                    </li>
                    <li data-filtertext="wai-aria voiceover accessibility screen reader">
                        <a href="jugadores.html" data-ajax="false">Jugadores</a>
                    </li>
                    <li data-filtertext="accordions collapsible set collapsible-set collapsed">
                        <a href="equipos.html" data-ajax="false">Equipos</a>
                    </li>
                    <li data-filtertext="accordions collapsible set collapsible-set collapsed">
                        <a href="categorias.html" data-ajax="false">Categorias</a>
                    </li>
                    <li data-filtertext="ajax navigation model">
                        <a href="mapa.html">Mapa</a>
                    </li>
                    <li data-filtertext="ajax navigation model">
                        <a href="twitter.html">Twitter</a>
                    </li>
                </ul>               
            </div>
            <!-- FIN MENU -->
		</div>
        <!-- FIN PAGINA -->
	</body>
</html>