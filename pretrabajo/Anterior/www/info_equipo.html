<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Cantabria Padel Rank v3</title>
        <link rel="shortcut icon" href="favicon.ico">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link rel="stylesheet" href="css/general.css">
		<link rel="stylesheet" href="css/ficha_jugador.css">
    
        <link rel="stylesheet" href="css/JK7.min.css">
        <link rel="stylesheet" href="css/jquery.mobile.icons.min.css">
        <link rel="stylesheet" href="css/jquery.mobile.structure-1.4.5.min.css">

                    
        <script src="js/jquery-1.11.2.min.js"></script>
        <script src="js/jquery.mobile-1.4.5.min.js"></script>
        <script src="js/generales.js"></script>
        
        <script charset="utf-8">
        
            $( document ).on( "pagecreate", function() {
    
                // Obtenemos el ID del jugador que vamos a buscar su informacion
                var id 		= $_GET("id");
    
                var fecha 	= new Date();
                var ano 	= fecha.getFullYear();
				
				var nun_jg	= 0; // Numero de jugadores
                var pts_max = 0; // Maximos puntos de jugador
                var pts_min = 99999; // Maximos puntos de jugador
				var pts_sum = 0; // Suma de puntos total
				var media 	= 0; // Media
				
                $.ajax({
                    url: PATH + "ws_resp_info_equipo.php",
                    type: 'GET',
                    dataType: 'json',
                    async: false,
                    crossDomain: true,
                    timeout: 5000,
                    data: {
                        id	: id
                    },
                    success: function(data){
                        
                        $("#lbName").html(data[0].equipo);					
                        
                        var imagen = "";
                        
                        if (data[0].id_club != null){
                            imagen = "img/clubs/cl_" + data[0].id_club + ".png";
                        }
                        else{
                            imagen = "img/teams/eq_" + data[0].id_equipo + ".png";
                        }
    
                        var row_html = "";
                        var img_html = "<img id='imgPhoto' class='image_block' title='" + data[0].equipo + "' " + 
                                            "src='" + PATH + imagen + "' " + 
                                            "alt='" + data[0].equipo + "' OnError='this.src=\"img/sin_foto_75x70.png\"'>";
                        
                        $("#player_data_photo").html(img_html);
                        
                        j = 0;
                        temp = "";
                        while (j < data.length){
							
                            temp = temp + "<div class='player_data_block'>" + 
                                          "	<span id='lbEquipoTittle' class='player_data_title'>" + data[j].temporada + "</span>" +
                                          "	<span id='lbEquipo' class='player_data_value'>" + data[j].categoria + "</span>" +
                                          "</div>";
                            j++;
                        }
                        $("#data_main").html(temp);
                        						
                        $.ajax({
                            url: PATH + "ws_resp_info_equipo_jugadores.php",
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            crossDomain: true,
                            timeout: 5000,
                            data: {
                                id	: id
                            },
                            success: function(data2){
    
                                var i 		= 0;
                                
                                html = 	"<table data-role='table' data-mode='table' class='ui-responsive' id='player_list'>" +
                                        "	<thead>" +
                                        "		<tr>" +
                                        "			<th></th>" +
                                        "			<th></th>" +
                                        "			<th></th>" +
                                        "		</tr>" +
                                        "	</thead>" +
                                        "	<tbody>";
    
                                while (i < data2.length){
                                    
									nun_jg++;
									if (pts_max < eval(data2[i].puntos)){
										pts_max = data2[i].puntos
									}
									
									if (pts_min > eval(data2[i].puntos)){
										pts_min = data2[i].puntos
									}
									
									pts_sum = pts_sum + eval(data2[i].puntos);
									
                                    html = html + "<tr>";
                                    html = html +   "	<td><img src='" + PATH + "img/players/x_" + data2[i].id_jugador + ".jpg' class='imgPhoto'></td>";
                                    html = html + 	"	<td><a href='info_jugador.html?id=" + data2[i].id_jugador +"' data-ajax='false'>" + data2[i].rank + "ยบ " + data2[i].jugador + "</a></td>";
                                    html = html + 	"	<td>" + data2[i].puntos + "</td>";
                                    html = html + "</tr>";								
                                    i++;
                                }							
                                html = html + "	</tbody>" +
                                              "</table>";
                                              
                                $("#table_box_jg").html(html);
                                
                            }
                        });
/*****************************************************************************/
						$.ajax({
                            url: PATH + "ws_resp_info_equipo_calendario.php",
                            type: 'GET',
                            dataType: 'json',
                            async: false,
                            crossDomain: true,
                            timeout: 5000,
                            data: {
                                id	: id
                            },
                            success: function(data3){
    
                                var k = 0;
                                
                                html = 	"<table data-role='table' data-mode='table' class='ui-responsive' id='player_list'>" +
                                        "	<thead>" +
                                        "		<tr>" +
                                        "			<th>Fecha</th>" +
                                        "			<th>Cat</th>" +
                                        "			<th>Jornada</th>" +
										"			<th>Local</th>" +
										"			<th>Visitante</th>" +
										"			<th>Resultado</th>" +
                                        "		</tr>" +
                                        "	</thead>" +
                                        "	<tbody>";
    
                                while (k < data3.length){
                                    
									var cat = data3[k].categoria.substring(0, 6);
									var jor = "Jor " + data3[k].jornada.substring(8);
									
                                    html = html + "<tr>";
                                    html = html +   "	<td>" + data3[k].fecha + "</td>";
                                    html = html +   "	<td>" + cat + "</td>";
                                    html = html +   "	<td>" + jor + "</td>";
                                    html = html +   "	<td><a href='info_equipo.html?id=" + data3[k].local +"' data-ajax='false'>" + data3[k].nlocal + "</a></td>";
                                    html = html +   "	<td><a href='info_equipo.html?id=" + data3[k].visitante +"' data-ajax='false'>" + data3[k].nvisitante + "</a></td>";
                                    html = html + 	"	<td>" + data3[k].resultado + "</td>";
                                    html = html + "</tr>";								
                                    k++;
                                }							
                                html = html + "	</tbody>" +
                                              "</table>";
                                              
                                $("#table_box_cal").html(html);
								$("#j").addClass("ui-btn-active");
                            }
                        });
/*****************************************************************************/						
						

						media =	(pts_sum/nun_jg).toFixed(0);				
						html  =	"<div class='player_data_block'>" +
								"	<span id='lbnjgsTittle' class='player_data_title'>Nยบ Jugadores</span>" +
								"	<span id='lbnjgs' class='player_data_value'>" + nun_jg + "</span>" +
								"</div>" +
								"<div class='player_data_block'>" +
								"	<span id='lbmaxptsTittle' class='player_data_title'>Max. puntos jugador</span>" +
								"	<span id='lbmaxpts' class='player_data_value'>" + pts_max + "</span>" +
								"</div>" +
								"<div class='player_data_block'>" +
								"	<span id='lbminptsTittle' class='player_data_title'>Min. puntos Jugador</span>" +
								"	<span id='lbminpts' class='player_data_value'>" + pts_min + "</span>" +
								"</div>" +
								"<div class='player_data_block'>" +
								"	<span id='lbmedptsTittle' class='player_data_title'>Media de puntos</span>" +
								"	<span id='lbmedpts' class='player_data_value'>" + media + "</span>" +
								"</div>";
						
						$("#data_main_aux").html(html);					
                    }
                });
                
                $('#player_list tr').click(function() {
    
                    var href = $(this).find("a").attr("href");
                    if(href) {
                        window.location = href;
                    }
                });
            });
        </script>
    
    </head>
	<body>
		<!-- INICIO PAGINA -->
        <div data-role="page" class="ui-responsive-panel" data-add-back-btn="true">
            <!-- INICIO CABECERA -->    
            <div data-role="header" data-theme="a">
                <a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>                
                <h1><a href="https://play.google.com/store/apps/details?id=com.jk7.CantabriaPdlRank2&hl=es" class="titulo">C.P.R.</a></h1>
                <a href="#" data-icon="back" data-iconpos="notext" data-rel="back">Atras</a>                
            </div>
            <!-- FIN CABECERA -->
			<!-- INICIO CONTENIDO -->
            <div data-role="content">
<!----------------------------------------------------------->
                <div class="player_box">
                    <div class="player_data_block_white" style="margin-top: 8px">
                        <span id="lbNameTitle" class="player_data_title">Equipo</span>
                        <span id="lbName" class="player_data_value"></span>	
                    </div>
                    <div style="overflow: hidden">
                        <div class="player_data_photo" id="player_data_photo">
                                                   
                        </div>
                        <div id="data_main" class="player_data_main">
                                                        
                        </div>
                        <div id="data_main_aux" class="player_data_main_aux">
                        	
                        </div>                        
                    </div>               
                </div>
                <div data-role="tabs" id="tabs">
                    <div data-role="navbar">
                        <ul>
                            <li><a href="#tab-1" id="j" data-ajax="false">Jugadores</a></li>
                            <li><a href="#tab-2" id="c" data-ajax="false">Calendario</a></li>                        
                        </ul>
                    </div>
                    <div id="tab-1" class="ui-body-d ui-content">
						<div class="table_box" id="table_box_jg"></div> 
                    </div>
                    <div id="tab-2">
                        <div class="table_box" id="table_box_cal"></div>
                    </div>
                </div>     
<!------------------------------------------------------------------>            
			</div>
            <!-- FIN CONTENIDO -->
            <!-- INICIO PIE -->
            <div >
                <a href="http://tunein.com/radio/Radio-Meruelo-1071-s114032/">
                	<img src='http://topera.esy.es/img/radio_meruelo.png' class="footer">
                </a>
            </div>
            <!-- FIN PIE -->
                
			<style>
                .nav-search .ui-btn-up-a {
                    background-image:none;
                    background-color:#333333;
                }
                .nav-search .ui-btn-inner {
                    border-top: 1px solid #888;
                    border-color: rgba(255, 255, 255, .1);
                }
            </style>

			<!-- INICIO MENU -->    
            <div data-role="panel" data-position="left" data-position-fixed="false" data-display="reveal" id="nav-panel" data-theme="a">
                <ul data-role="listview" data-theme="a" data-divider-theme="a" style="margin-top:-16px;" class="nav-search">                    
                    <li data-filtertext="wai-aria voiceover accessibility screen reader">
                        <a href="index.html" data-ajax="false">Inicio</a>
                    </li>
                    <li data-filtertext="wai-aria voiceover accessibility screen reader">
                        <a href="jugadores.html" data-ajax="false">Jugadores</a>
                    </li>
                    <li data-filtertext="accordions collapsible set collapsible-set collapsed">
                        <a href="equipos.html" data-ajax="false">Equipos</a>
                    </li>
                    <li data-filtertext="accordions collapsible set collapsible-set collapsed">
                        <a href="categorias.html" data-ajax="false">Categorias</a>
                    </li>
                    <li data-filtertext="ajax navigation model">
                        <a href="mapa.html">Mapa</a>
                    </li>
                    <li data-filtertext="ajax navigation model">
                        <a href="twitter.html">Twitter</a>
                    </li>
                </ul>               
            </div>
            <!-- FIN MENU -->
		</div>
        <!-- FIN PAGINA -->
	</body>
</html>
